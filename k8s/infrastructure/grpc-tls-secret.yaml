# gRPC mTLS Certificates Secret (P0-1)
#
# Production deployment: Use External Secrets Operator with cert-manager
# Development/Testing: Replace with actual certificate files
#
# Certificate generation via cert-manager (recommended):
#   kubectl apply -f cert-manager-issuer.yaml
#   kubectl apply -f grpc-tls-certificate.yaml
#
# Manual generation (development only):
#   openssl req -x509 -newkey rsa:4096 -keyout ca-key.pem -out ca-cert.pem -days 365 -nodes -subj "/CN=Nova CA"
#   openssl req -newkey rsa:4096 -keyout server-key.pem -out server-csr.pem -nodes -subj "/CN=*.nova.svc.cluster.local"
#   openssl x509 -req -in server-csr.pem -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -out server-cert.pem -days 365
#
apiVersion: v1
kind: Secret
metadata:
  name: grpc-tls-certs
  namespace: nova
  labels:
    app.kubernetes.io/name: grpc-tls
    app.kubernetes.io/component: security
    app.kubernetes.io/managed-by: cert-manager  # Or manual in dev
type: kubernetes.io/tls
data:
  # Base64-encoded certificate files
  # Replace with actual cert data or use External Secrets Operator

  # CA Certificate (for client validation)
  ca.crt: LS0tLS1CRUdJTi...  # Base64 encoded CA cert

  # Server Certificate (per-service or wildcard *.nova.svc.cluster.local)
  tls.crt: LS0tLS1CRUdJTi...  # Base64 encoded server cert

  # Server Private Key
  tls.key: LS0tLS1CRUdJTi...  # Base64 encoded server key

  # Client Certificate (for mTLS client authentication)
  client.crt: LS0tLS1CRUdJTi...  # Base64 encoded client cert

  # Client Private Key
  client.key: LS0tLS1CRUdJTi...  # Base64 encoded client key

---
# Example External Secrets Operator integration (production)
# Uncomment and configure for production use
#
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: grpc-tls-certs
#   namespace: nova
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: vault-backend
#     kind: SecretStore
#   target:
#     name: grpc-tls-certs
#     creationPolicy: Owner
#   dataFrom:
#   - extract:
#       key: grpc/tls-certs
#   data:
#   - secretKey: ca.crt
#     remoteRef:
#       key: grpc/ca-cert
#   - secretKey: tls.crt
#     remoteRef:
#       key: grpc/server-cert
#   - secretKey: tls.key
#     remoteRef:
#       key: grpc/server-key
#   - secretKey: client.crt
#     remoteRef:
#       key: grpc/client-cert
#   - secretKey: client.key
#     remoteRef:
#       key: grpc/client-key
