---
# S3 和数据库凭证
apiVersion: v1
kind: Secret
metadata:
  name: nova-s3-credentials
  namespace: nova
type: Opaque
stringData:
  # AWS S3 配置
  AWS_REGION: us-east-1
  S3_BUCKET: nova-uploads
  AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}        # 由 CI/CD 替换
  AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}  # 由 CI/CD 替换
  AWS_SESSION_TOKEN: ""  # 由 STS 轮换器自动写入

---
# 数据库凭证
apiVersion: v1
kind: Secret
metadata:
  name: nova-db-credentials
  namespace: nova
type: Opaque
stringData:
  # 通用数据库 URL（向后兼容）
  DATABASE_URL: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  DB_USER: nova
  DB_PASSWORD: ${DB_PASSWORD}  # 由 CI/CD 替换

  # 各服务专用数据库 URL（统一到 nova_content 以解决外键约束问题）
  auth-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  user-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  content-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  feed-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  media-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  messaging-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  search-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content
  streaming-db-url: postgres://nova:${DB_PASSWORD}@postgres:5432/nova_content

  # 其他基础设施服务 URL
  elasticsearch-url: http://elasticsearch:9200
  redis-url: redis://redis:6379

---
# Redis 凭证
apiVersion: v1
kind: Secret
metadata:
  name: nova-redis-credentials
  namespace: nova
type: Opaque
stringData:
  REDIS_URL: redis://redis:6379

---
# JWT 密钥
apiVersion: v1
kind: Secret
metadata:
  name: nova-jwt-keys
  namespace: nova
type: Opaque
stringData:
  JWT_PUBLIC_KEY_PEM: |
    ${JWT_PUBLIC_KEY}  # 由 CI/CD 替换
  JWT_PRIVATE_KEY_PEM: |
    ${JWT_PRIVATE_KEY}  # 由 CI/CD 替换

---
# 推送通知凭证（APNs / FCM）
apiVersion: v1
kind: Secret
metadata:
  name: nova-push-credentials
  namespace: nova
type: Opaque
stringData:
  # Apple Push Notification (APNs) - 使用 .p8 私钥文件
  apns-cert.p8: |
    ${APNS_PRIVATE_KEY_P8}  # 由 CI/CD 或 Secrets Manager 提供
  APNS_BUNDLE_ID: ${APNS_BUNDLE_ID}
  APNS_TEAM_ID: ${APNS_TEAM_ID}
  APNS_KEY_ID: ${APNS_KEY_ID}
  APNS_IS_PRODUCTION: "${APNS_IS_PRODUCTION:-false}"
  APNS_CERTIFICATE_PASSPHRASE: "${APNS_CERTIFICATE_PASSPHRASE:-}"

  # Firebase Cloud Messaging (FCM)
  FCM_API_KEY: ${FCM_API_KEY}
