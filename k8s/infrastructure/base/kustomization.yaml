apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: nova-base

# 资源清单
resources:
- namespace.yaml
- configmap.yaml
- secrets.yaml
# StorageClass for EBS gp3 volumes (PostgreSQL, Redis, ClickHouse)
- storageclass-gp3.yaml
# 基础设施服务
- postgres.yaml
- redis.yaml
- redis-pvc.yaml
- elasticsearch.yaml
# NOTE: Microservices are now defined in k8s/microservices/ directory
# Do NOT include them here to avoid duplication and conflicts
# Legacy service definitions (user-service.yaml, content-service.yaml, etc.) have been removed

# NOTE: namespace 应由 overlay 设置（staging: nova-staging, production: nova-production）
# 不在 base 设置 namespace，避免与 overlay 的 namespace 转换冲突

# 通用标签（仅保留与环境无关的固定标签）
# 环境相关的标签（如 environment: staging/production）应在 overlay 中设置
labels:
  - pairs:
      managed-by: kustomize

# 通用注解（环境无关）
commonAnnotations:
  deployment.kubernetes.io/revision: "1"

# NOTE: Image transformations are now handled in overlay kustomizations
# Legacy image configurations removed - use k8s/infrastructure/overlays/staging/kustomization.yaml instead

# ConfigMap 已在 configmap.yaml 中定义,不使用生成器避免冲突

# Secret 生成器 (最好用于开发环境)
# secretGenerator:
# - name: nova-db-credentials
#   literals:
#   - DATABASE_URL=postgres://nova:password@postgres:5432/nova_content

# NOTE: Replica configurations are now in microservices deployment files
# Legacy replica configurations removed

# 处理器 (patchesStrategicMerge 用于部分覆盖)
# patchesStrategicMerge:
# - deployment-patch.yaml

# 输出配置
# sortOrder: legacy  # 保持 YAML 顺序
