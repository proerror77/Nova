apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: nova-base
  namespace: nova

# 资源清单
resources:
- namespace.yaml
- configmap.yaml
- secrets.yaml
# 基础设施服务
- postgres.yaml
- redis.yaml
- elasticsearch.yaml
# 微服务
- auth-service.yaml
- user-service.yaml
- content-service.yaml
- feed-service.yaml
- media-service.yaml
- messaging-service.yaml
- search-service.yaml
- streaming-service.yaml
- ingress.yaml

# 命名空间配置
namespace: nova

# 通用标签
commonLabels:
  app: nova
  managed-by: kustomize

# 通用注解
commonAnnotations:
  deployment.kubernetes.io/revision: "1"

# 镜像替换 (用于 CI/CD 流程)
images:
- name: nova/auth-service
  newTag: latest
- name: nova/user-service
  newTag: latest
- name: nova/content-service
  newTag: latest
- name: nova/feed-service
  newTag: latest
- name: nova/media-service
  newTag: latest
- name: nova/messaging-service
  newTag: latest
- name: nova/search-service
  newTag: latest
- name: nova/streaming-service
  newTag: latest

# ConfigMap 已在 configmap.yaml 中定义,不使用生成器避免冲突

# Secret 生成器 (最好用于开发环境)
# secretGenerator:
# - name: nova-db-credentials
#   literals:
#   - DATABASE_URL=postgres://nova:password@postgres:5432/nova_content

# 副本数配置
replicas:
- name: auth-service
  count: 2
- name: user-service
  count: 2
- name: content-service
  count: 2
- name: feed-service
  count: 2
- name: media-service
  count: 2
- name: messaging-service
  count: 2
- name: search-service
  count: 2
- name: streaming-service
  count: 2

# 处理器 (patchesStrategicMerge 用于部分覆盖)
# patchesStrategicMerge:
# - deployment-patch.yaml

# 输出配置
# sortOrder: legacy  # 保持 YAML 顺序
