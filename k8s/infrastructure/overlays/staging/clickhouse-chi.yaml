apiVersion: clickhouse.altinity.com/v1
kind: ClickHouseInstallation
metadata:
  name: nova-ch
  namespace: clickhouse
spec:
  configuration:
    files:
      users.d/nova.xml: |
        <yandex>
          <users>
            <nova>
              <password_sha256_hex>f6884edbbb3e10794ba1321c07aaf231f174550a71bfb541a1c149c0f61fbbea</password_sha256_hex>
              <networks>
                <ip>0.0.0.0/0</ip>
              </networks>
              <profile>default</profile>
              <quota>default</quota>
            </nova>
          </users>
        </yandex>
    clusters:
      - name: single
        layout:
          shardsCount: 1
          replicasCount: 1
        templates:
          podTemplate: ch-pod
    users:
      nova/password_sha256_hex: "f6884edbbb3e10794ba1321c07aaf231f174550a71bfb541a1c149c0f61fbbea"
      nova/networks/ip:
        - 0.0.0.0/0
      nova/profile: default
      nova/quota: default
  templates:
    podTemplates:
      - name: ch-pod
        spec:
          containers:
            - name: clickhouse
              image: clickhouse/clickhouse-server:24.8
              volumeMounts:
                - name: data
                  mountPath: /var/lib/clickhouse
          volumes:
            - name: data
              persistentVolumeClaim:
                claimName: nova-ch-data
