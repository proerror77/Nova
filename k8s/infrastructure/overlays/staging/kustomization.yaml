apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: nova

patchesStrategicMerge:
- deployment-patch.yaml
- secrets-patch.yaml
- configmap-patch.yaml
- deployment-images-patch.yaml
- postgres-deploy-patch.yaml
- service-selectors-patch.yaml
- redis-deploy-patch.yaml
- deploy-labels-patch.yaml
- user-service-env-patch.yaml
- elasticsearch-replicas-patch.yaml
- s3-env-patch.yaml
- hpa-min1-patch.yaml
 - sts-rotator.yaml

images:
- name: nova/auth-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/auth-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/content-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/content-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/feed-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/feed-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/media-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/media-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/messaging-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/messaging-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/search-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/search-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/streaming-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/streaming-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56
- name: nova/user-service
  newName: 025434362120.dkr.ecr.ap-northeast-1.amazonaws.com/nova/user-service
  newTag: 38cc45e2f3b81a611e60955577b5a0a1120fbf56

replicas:
- count: 0
  name: auth-service
- count: 1
  name: user-service
- count: 1
  name: content-service
- count: 1
  name: feed-service
- count: 1
  name: media-service
- count: 1
  name: messaging-service
- count: 1
  name: search-service
- count: 1
  name: streaming-service

commonAnnotations:
  argocd.argoproj.io/compare-result: "false"
  deployment.kubernetes.io/version: "1"
  environment: staging

resources:
- ../../base
- postgres-pvc-gp3.yaml
