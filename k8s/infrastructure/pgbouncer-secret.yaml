# PgBouncer Secret Template
# IMPORTANT: This file contains placeholder values for demonstration purposes.
# In production, use Kubernetes External Secrets Operator (ESO) or Sealed Secrets
# to manage credentials securely from AWS Secrets Manager or similar.
#
# To generate MD5 password hash for userlist.txt:
# echo -n "passwordusername" | md5sum | awk '{print "md5"$1}'
#
# Example:
# echo -n "secretpasswordpostgres" | md5sum | awk '{print "md5"$1}'
# Result: md5abc123def456...

apiVersion: v1
kind: Secret
metadata:
  name: pgbouncer-secret
  namespace: nova
  labels:
    app: pgbouncer
    component: database
type: Opaque
stringData:
  # PostgreSQL admin password (for pgbouncer-exporter)
  postgres-password: "REPLACE_WITH_ACTUAL_PASSWORD"

  # PgBouncer userlist.txt content
  # Format: "username" "md5hash"
  userlist.txt: |
    "postgres" "REPLACE_WITH_MD5_HASH"
    "nova_user" "REPLACE_WITH_MD5_HASH"

---
# Example ExternalSecret configuration for AWS Secrets Manager
# Uncomment and configure when using External Secrets Operator
#
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: pgbouncer-secret
#   namespace: nova
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secretsmanager
#     kind: SecretStore
#   target:
#     name: pgbouncer-secret
#     creationPolicy: Owner
#     template:
#       engineVersion: v2
#       data:
#         postgres-password: "{{ .postgresPassword }}"
#         userlist.txt: |
#           "postgres" "{{ .postgresPasswordMd5 }}"
#           "nova_user" "{{ .novaUserPasswordMd5 }}"
#   dataFrom:
#   - extract:
#       key: nova/pgbouncer-credentials
