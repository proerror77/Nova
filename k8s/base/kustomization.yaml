apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 基础 Kustomize 配置
# 这个文件定义所有环境共用的基础配置
# 环境特定的覆盖由 overlays 目录定义

# 命名空间（会被 overlay 覆盖）
namespace: nova-staging

# 通用标签
commonLabels:
  app.kubernetes.io/name: nova
  app.kubernetes.io/managed-by: argocd

# 通用注解
commonAnnotations:
  description: "Nova Microservices Platform"

# 包含的资源
# 这些是所有环境都需要的共同资源
resources:
  - ../microservices/

# 变量替换
vars:
  - name: IMAGE_REGISTRY
    objref:
      kind: ConfigMap
      name: image-registry
      apiVersion: v1
    fieldref:
      fieldpath: data.registry

# 配置管理生成器
configMapGenerator:
  - name: nova-config
    literals:
      - APP_NAME=nova
      - API_VERSION=v1

# 密钥生成（如需要）
# secretGenerator:
#   - name: nova-secrets
#     envs:
#       - secrets.env
