apiVersion: v1
kind: ConfigMap
metadata:
  name: graphql-gateway-configmap
  labels:
    app: graphql-gateway
    version: v2
data:
  # Server configuration
  server-host: "0.0.0.0"
  server-port: "8080"

  # Service endpoints (V2 architecture)
  auth-service-url: "http://identity-service.nova.svc.cluster.local:50051"
  user-service-url: "http://user-service.nova.svc.cluster.local:50054"
  content-service-url: "http://content-service.nova.svc.cluster.local:50055"
  social-service-url: "http://social-service.nova.svc.cluster.local:50052"
  communication-service-url: "http://communication-service.nova.svc.cluster.local:50053"
  media-service-url: "http://media-service.nova.svc.cluster.local:50056"
  search-service-url: "http://search-service.nova.svc.cluster.local:50057"
  events-service-url: "http://events-service.nova.svc.cluster.local:50058"

  # GraphQL Security Configuration (P0-2)
  # Based on Codex GPT-5 recommendations
  graphql-max-complexity: "1000"
  graphql-max-depth: "10"
  graphql-max-backend-calls: "10"
  graphql-max-queries-per-minute: "100"
  graphql-max-mutations-per-minute: "20"
  graphql-allow-introspection: "false"  # Disable in production
  graphql-use-persisted-queries: "true"

  # Rate limiting
  rate-limit-req-per-second: "100"
  rate-limit-burst-size: "10"

  # Timeout configuration
  graphql-timeout: "30s"
  grpc-timeout: "10s"

  # Logging level
  log-level: "info"

  # Cache configuration
  cache-ttl-default: "300"  # 5 minutes

  # Kafka configuration (for subscriptions)
  kafka-brokers: "kafka-broker-0.kafka-headless.kafka:9092,kafka-broker-1.kafka-headless.kafka:9092,kafka-broker-2.kafka-headless.kafka:9092"
