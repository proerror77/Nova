apiVersion: v1
kind: ConfigMap
metadata:
  name: graphql-gateway-configmap
  labels:
    app: graphql-gateway
    version: v2
data:
  # Server configuration
  SERVER_HOST: "0.0.0.0"
  SERVER_PORT: "8080"

  # gRPC Service endpoints (must match GRPC_*_URL env vars expected by code)
  # All services use port 9080 for gRPC (standardized)
  GRPC_IDENTITY_SERVICE_URL: "http://identity-service:9080"
  GRPC_CONTENT_SERVICE_URL: "http://content-service:9080"
  GRPC_FEED_SERVICE_URL: "http://feed-service:9080"
  GRPC_SOCIAL_SERVICE_URL: "http://social-service:9080"
  GRPC_CHAT_SERVICE_URL: "http://realtime-chat-service:9080"
  GRPC_MEDIA_SERVICE_URL: "http://media-service:9080"
  GRPC_SEARCH_SERVICE_URL: "http://search-service:9080"
  GRPC_NOTIFICATION_SERVICE_URL: "http://notification-service:9080"
  GRPC_GRAPH_SERVICE_URL: "http://graph-service:9080"
  GRPC_RANKING_SERVICE_URL: "http://ranking-service:9080"
  GRPC_ANALYTICS_SERVICE_URL: "http://analytics-service:9080"

  # gRPC connection settings
  GRPC_CONNECTION_TIMEOUT_SECS: "10"
  GRPC_REQUEST_TIMEOUT_SECS: "30"

  # GraphQL Security Configuration
  GRAPHQL_MAX_COMPLEXITY: "1000"
  GRAPHQL_MAX_DEPTH: "10"
  GRAPHQL_MAX_BACKEND_CALLS: "10"
  GRAPHQL_MAX_QUERIES_PER_MINUTE: "100"
  GRAPHQL_MAX_MUTATIONS_PER_MINUTE: "20"
  GRAPHQL_ALLOW_INTROSPECTION: "false"
  GRAPHQL_USE_PERSISTED_QUERIES: "true"

  # Rate limiting
  RATE_LIMIT_REQ_PER_SECOND: "100"
  RATE_LIMIT_BURST_SIZE: "10"

  # Timeout configuration
  GRAPHQL_TIMEOUT: "30s"
  GRPC_TIMEOUT: "10s"

  # Logging level
  LOG_LEVEL: "info"
  RUST_LOG: "info,graphql_gateway=debug"

  # Cache configuration
  CACHE_TTL_DEFAULT: "300"

  # Kafka configuration (for subscriptions)
  KAFKA_BROKERS: "kafka-broker-0.kafka-headless.kafka:9092,kafka-broker-1.kafka-headless.kafka:9092,kafka-broker-2.kafka-headless.kafka:9092"

  # Matrix E2EE Integration (HTTP endpoint for chat service)
  CHAT_SERVICE_HTTP_URL: "http://realtime-chat-service:8080"
