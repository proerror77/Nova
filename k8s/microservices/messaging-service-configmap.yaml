---
# ConfigMap for Messaging Service Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: messaging-service-config
  namespace: nova-messaging
  labels:
    app: nova
    component: messaging-service
data:
  # Application Settings
  APP_ENV: "production"
  PORT: "3000"
  RUST_LOG: "messaging_service=info,axum=info,tower_http=warn"
  HOST: "0.0.0.0"

  # Database Settings (using service DNS)
  # Update POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB from Secret
  DATABASE_MAX_CONNECTIONS: "10"
  DATABASE_POOL_TIMEOUT: "30"
  DATABASE_IDLE_TIMEOUT: "600"

  # Redis Settings
  REDIS_POOL_SIZE: "20"
  REDIS_CONNECT_TIMEOUT: "5"
  REDIS_POOL_TIMEOUT: "10"

  # Kafka Settings
  KAFKA_COMPRESSION_TYPE: "snappy"
  KAFKA_REQUEST_TIMEOUT_MS: "30000"
  KAFKA_CONSUMER_GROUP: "messaging-service"

  # WebSocket Settings
  WS_DEV_ALLOW_ALL: "false"  # Set to true only in dev
  WS_MAX_FRAME_SIZE: "1048576"  # 1MB
  WS_MESSAGE_BUFFER_SIZE: "256"

  # Video Call Settings
  VIDEO_CALL_MAX_DURATION_HOURS: "12"
  VIDEO_CALL_IDLE_TIMEOUT_MINUTES: "5"
  VIDEO_CALL_ICE_GATHERING_TIMEOUT: "10"

  # Message Settings
  MESSAGE_RECALL_WINDOW_HOURS: "2"
  MESSAGE_MAX_LENGTH: "4096"
  AUDIO_MESSAGE_MAX_DURATION_SECS: "600"

  # Performance Settings
  MESSAGE_BATCH_SIZE: "100"
  ICE_CANDIDATE_BATCH_SIZE: "50"
  BROADCAST_TIMEOUT_SECS: "30"

  # Health Check Settings
  HEALTH_CHECK_INTERVAL_SECS: "10"
  HEALTH_CHECK_TIMEOUT_SECS: "5"
