apiVersion: v1
kind: ConfigMap
metadata:
  name: nova-config
  namespace: nova
  labels:
    app: nova
data:
  # Application environment
  APP_ENV: "production"
  APP_HOST: "0.0.0.0"
  APP_PORT: "8080"
  RUST_LOG: "info,actix_web=info,sqlx=warn"

  # Database configuration
  DATABASE_MAX_CONNECTIONS: "20"

  # Redis configuration
  REDIS_POOL_SIZE: "10"

  # JWT configuration
  JWT_ACCESS_TOKEN_TTL: "3600"       # 1 hour
  JWT_REFRESH_TOKEN_TTL: "2592000"   # 30 days

  # Rate limiting
  RATE_LIMIT_MAX_REQUESTS: "100"
  RATE_LIMIT_WINDOW_SECS: "60"

  # Kafka (shared defaults)
  KAFKA_BROKERS: "nova-kafka:9092"
  KAFKA_EVENTS_TOPIC: "nova-events"

  # gRPC endpoints
  CONTENT_SERVICE_GRPC_URL: "http://content-service.nova:9081"

  # ClickHouse
  CLICKHOUSE_URL: "http://clickhouse.nova:8123"
  CLICKHOUSE_DATABASE: "nova_feed"
  CLICKHOUSE_USERNAME: "default"
  CLICKHOUSE_QUERY_TIMEOUT_MS: "2000"

  # S3 configuration
  S3_BUCKET_NAME: "nova-staging-videos"
  AWS_REGION: "ap-northeast-1"
  S3_PRESIGNED_URL_EXPIRY_SECS: "900"  # 15 minutes
  CLOUDFRONT_URL: "http://api-gateway:80"  # Change to CloudFront domain in production

  # CORS configuration (comma-separated)
  CORS_ALLOWED_ORIGINS: "https://nova.app,https://www.nova.app,https://app.nova.app"
  CORS_MAX_AGE: "3600"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
  namespace: nova
  labels:
    app: nova-postgres
data:
  # PostgreSQL configuration
  POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=C"
