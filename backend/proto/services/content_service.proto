syntax = "proto3";

package nova.content_service.v1;

import "common.proto";

// Content Service - gRPC interface for post/comment/like operations
// Serves content-service (port 8081)

message Post {
    string id = 1;
    string creator_id = 2;
    string content = 3;
    int64 created_at = 4;
    int64 updated_at = 5;
}

message Comment {
    string id = 1;
    string post_id = 2;
    string creator_id = 3;
    string content = 4;
    int64 created_at = 5;
}

message GetPostRequest {
    string post_id = 1;
}

message GetPostResponse {
    Post post = 1;
    bool found = 2;
    .nova.common.v1.ErrorStatus error = 3;
}

message CreatePostRequest {
    string creator_id = 1;
    string content = 2;
}

message CreatePostResponse {
    Post post = 1;
    .nova.common.v1.ErrorStatus error = 2;
}

message GetCommentsRequest {
    string post_id = 1;
    int32 limit = 2;
    int32 offset = 3;
}

message GetCommentsResponse {
    repeated Comment comments = 1;
    int32 total = 2;
    .nova.common.v1.ErrorStatus error = 3;
}

message LikePostRequest {
    string post_id = 1;
    string user_id = 2;
}

message LikePostResponse {
    bool success = 1;
    .nova.common.v1.ErrorStatus error = 2;
}

message GetUserBookmarksRequest {
    string user_id = 1;
    int32 limit = 2;
    int32 offset = 3;
}

message GetUserBookmarksResponse {
    repeated Post posts = 1;
    int32 total = 2;
    .nova.common.v1.ErrorStatus error = 3;
}

// Feed-related messages removed - these belong to feed_service.proto
// The content service should only manage posts, comments, and likes
// Feed aggregation is the responsibility of the feed service

message GetPostsByIdsRequest {
    repeated string post_ids = 1;
}

message GetPostsByIdsResponse {
    repeated Post posts = 1;
}

message GetPostsByAuthorRequest {
    string author_id = 1;
    string status = 2;
    int32 limit = 3;
    int32 offset = 4;
}

message GetPostsByAuthorResponse {
    repeated Post posts = 1;
    int32 total_count = 2;
}

message UpdatePostRequest {
    string post_id = 1;
    string title = 2;
    string content = 3;
    string privacy = 4;
    string status = 5;
}

message UpdatePostResponse {
    Post post = 1;
}

message DeletePostRequest {
    string post_id = 1;
    string deleted_by_id = 2;
}

message DeletePostResponse {
    string post_id = 1;
    int64 deleted_at = 2;
}

message DecrementLikeCountRequest {
    string post_id = 1;
}

message DecrementLikeCountResponse {
    int32 like_count = 1;
}

message CheckPostExistsRequest {
    string post_id = 1;
}

message CheckPostExistsResponse {
    bool exists = 1;
}

// Comment CRUD operations
message CreateCommentRequest {
    string post_id = 1;
    string user_id = 2;
    string content = 3;
    string parent_comment_id = 4;  // optional, for nested replies
}

message CreateCommentResponse {
    Comment comment = 1;
    .nova.common.v1.ErrorStatus error = 2;
}

message UpdateCommentRequest {
    string comment_id = 1;
    string user_id = 2;  // for authorization check
    string content = 3;
}

message UpdateCommentResponse {
    Comment comment = 1;
    .nova.common.v1.ErrorStatus error = 2;
}

message DeleteCommentRequest {
    string comment_id = 1;
    string user_id = 2;  // for authorization check
}

message DeleteCommentResponse {
    string comment_id = 1;
    int64 deleted_at = 2;
}

// Like operations
message UnlikePostRequest {
    string post_id = 1;
    string user_id = 2;
}

message UnlikePostResponse {
    bool success = 1;
    .nova.common.v1.ErrorStatus error = 2;
}

message GetPostLikesRequest {
    string post_id = 1;
    int32 limit = 2;
    int32 offset = 3;
}

message PostLike {
    string user_id = 1;
    int64 liked_at = 2;
}

message GetPostLikesResponse {
    repeated PostLike likes = 1;
    int32 total_count = 2;
    .nova.common.v1.ErrorStatus error = 3;
}

// ContentService manages posts, comments, and likes
// Feed aggregation is handled by FeedService (feed_service.proto)
service ContentService {
    // Post operations
    rpc GetPost(GetPostRequest) returns (GetPostResponse) {}
    rpc CreatePost(CreatePostRequest) returns (CreatePostResponse) {}
    rpc UpdatePost(UpdatePostRequest) returns (UpdatePostResponse) {}
    rpc DeletePost(DeletePostRequest) returns (DeletePostResponse) {}
    rpc GetPostsByIds(GetPostsByIdsRequest) returns (GetPostsByIdsResponse) {}
    rpc GetPostsByAuthor(GetPostsByAuthorRequest) returns (GetPostsByAuthorResponse) {}
    rpc CheckPostExists(CheckPostExistsRequest) returns (CheckPostExistsResponse) {}

    // Comment operations
    rpc GetComments(GetCommentsRequest) returns (GetCommentsResponse) {}
    rpc CreateComment(CreateCommentRequest) returns (CreateCommentResponse) {}
    rpc UpdateComment(UpdateCommentRequest) returns (UpdateCommentResponse) {}
    rpc DeleteComment(DeleteCommentRequest) returns (DeleteCommentResponse) {}

    // Like operations
    rpc LikePost(LikePostRequest) returns (LikePostResponse) {}
    rpc UnlikePost(UnlikePostRequest) returns (UnlikePostResponse) {}
    rpc GetPostLikes(GetPostLikesRequest) returns (GetPostLikesResponse) {}
    rpc DecrementLikeCount(DecrementLikeCountRequest) returns (DecrementLikeCountResponse) {}

    // Bookmark operations
    rpc GetUserBookmarks(GetUserBookmarksRequest) returns (GetUserBookmarksResponse) {}
}
