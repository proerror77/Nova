apiVersion: v1
kind: ConfigMap
metadata:
  name: nova-backend-config
  namespace: nova-backend
data:
  # Environment
  APP_ENV: "development"
  LOG_LEVEL: "info"

  # Database
  DATABASE_MAX_CONNECTIONS: "10"
  DATABASE_MIN_CONNECTIONS: "2"
  DATABASE_ACQUIRE_TIMEOUT_SECS: "30"
  DATABASE_IDLE_TIMEOUT_SECS: "600"
  DATABASE_MAX_LIFETIME_SECS: "1800"
  RUN_MIGRATIONS: "true"

  # Redis
  REDIS_POOL_SIZE: "20"
  REDIS_CONNECTION_TIMEOUT_SECS: "5"

  # ClickHouse
  CLICKHOUSE_DATABASE: "nova"
  CLICKHOUSE_USERNAME: "default"

  # Kafka
  KAFKA_CONSUMER_GROUP_ID: "nova-consumer-v1"
  KAFKA_AUTO_OFFSET_RESET: "earliest"
  KAFKA_ENABLE_AUTO_COMMIT: "false"

  # Kafka Topics
  KAFKA_AUTH_EVENTS_TOPIC: "nova.auth.events"
  KAFKA_USER_EVENTS_TOPIC: "nova.user.events"
  KAFKA_CONTENT_EVENTS_TOPIC: "nova.content.events"
  KAFKA_MESSAGE_EVENTS_TOPIC: "nova.message.events"
  KAFKA_FEED_EVENTS_TOPIC: "nova.feed.events"
  KAFKA_IDENTITY_EVENTS_TOPIC: "nova.identity.events"
  # Identity service uses KAFKA_TOPIC_PREFIX for its event topic name
  KAFKA_TOPIC_PREFIX: "nova.identity.events"

  # JWT
  JWT_ACCESS_TOKEN_EXPIRES_IN_MINUTES: "60"
  JWT_REFRESH_TOKEN_EXPIRES_IN_DAYS: "90"

  # gRPC Configuration
  GRPC_AUTH_SERVICE_URL: "http://auth-service:9083"
  GRPC_CONTENT_SERVICE_URL: "http://content-service:9081"
  GRPC_FEED_SERVICE_URL: "http://feed-service:9084"
  GRPC_MEDIA_SERVICE_URL: "http://media-service:9082"
  GRPC_MESSAGING_SERVICE_URL: "http://messaging-service:9085"
  GRPC_SEARCH_SERVICE_URL: "http://search-service:9086"
  GRPC_STREAMING_SERVICE_URL: "http://streaming-service:8088"
  GRPC_NOTIFICATION_SERVICE_URL: "http://notification-service:9088"
  GRPC_CDN_SERVICE_URL: "http://cdn-service:9089"
  GRPC_EVENTS_SERVICE_URL: "http://events-service:9090"
  GRPC_CHAT_SERVICE_URL: "http://realtime-chat-service:9086"

  GRPC_CONNECTION_TIMEOUT_SECS: "10"
  GRPC_REQUEST_TIMEOUT_SECS: "30"
  GRPC_MAX_CONCURRENT_STREAMS: "1000"
  GRPC_KEEPALIVE_INTERVAL_SECS: "30"
  GRPC_KEEPALIVE_TIMEOUT_SECS: "10"
  GRPC_ENABLE_CONNECTION_POOLING: "true"
  GRPC_CONNECTION_POOL_SIZE: "10"
  GRPC_TLS_ENABLED: "false"

  # Matrix (E2EE messaging) - backend/realtime-chat-service consumes these.
  # Set MATRIX_ENABLED=true only after homeserver is reachable.
  MATRIX_ENABLED: "false"
  MATRIX_HOMESERVER_URL: "http://matrix-synapse:8008"
  MATRIX_SERVICE_USER: "@nova-service:nova.local"
  MATRIX_DEVICE_NAME: "nova-realtime-chat-service"
  # Server name used in Synapse config - should match your domain
  MATRIX_SERVER_NAME: "nova.local"

  # Rate Limiting
  RATE_LIMIT_MAX_REQUESTS: "100"
  RATE_LIMIT_WINDOW_SECS: "60"

  # Feature Flags
  ENABLE_FEED_SORTING: "true"
  ENABLE_VIDEO_TRANSCODING: "true"
  ENABLE_REAL_TIME_NOTIFICATIONS: "true"
  ENABLE_GROUP_CALLS: "true"

  # Service URLs (internal)
  DATABASE_URL: "postgresql://postgres:postgres@postgres:5432/nova"
  REDIS_URL: "redis://redis:6379"
  CLICKHOUSE_URL: "http://clickhouse:8123"
  KAFKA_BROKERS: "kafka:9092"
  ELASTICSEARCH_URL: "http://elasticsearch:9200"
