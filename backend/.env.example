# ==============================================
# Nova Backend - Environment Configuration
# ==============================================
# This file contains all configuration parameters for 11 microservices
# Copy this file to .env and modify values for your environment

# ==============================================
# Environment
# ==============================================
APP_ENV=development  # development | staging | production
LOG_LEVEL=info       # trace | debug | info | warn | error

# ==============================================
# Database - PostgreSQL
# ==============================================
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/nova
DATABASE_MAX_CONNECTIONS=10
DATABASE_MIN_CONNECTIONS=2
DATABASE_ACQUIRE_TIMEOUT_SECS=30
DATABASE_IDLE_TIMEOUT_SECS=600
DATABASE_MAX_LIFETIME_SECS=1800

# Database migrations (set to 'false' to skip migrations on startup)
RUN_MIGRATIONS=true

# ==============================================
# Redis Cache
# ==============================================
REDIS_URL=redis://redis:6379
REDIS_POOL_SIZE=20
REDIS_CONNECTION_TIMEOUT_SECS=5

# ==============================================
# ClickHouse (for Feed ranking)
# ==============================================
CLICKHOUSE_URL=http://clickhouse:8123
CLICKHOUSE_DATABASE=nova
CLICKHOUSE_USERNAME=default
CLICKHOUSE_PASSWORD=

# ==============================================
# Kafka (Event Streaming)
# ==============================================
KAFKA_BROKERS=kafka:9092
KAFKA_CONSUMER_GROUP_ID=nova-consumer-v1
KAFKA_AUTO_OFFSET_RESET=earliest  # earliest | latest
KAFKA_ENABLE_AUTO_COMMIT=false

# Kafka Topics
KAFKA_AUTH_EVENTS_TOPIC=nova.auth.events
KAFKA_USER_EVENTS_TOPIC=nova.user.events
KAFKA_CONTENT_EVENTS_TOPIC=nova.content.events
KAFKA_MESSAGE_EVENTS_TOPIC=nova.message.events
KAFKA_FEED_EVENTS_TOPIC=nova.feed.events

# ==============================================
# Elasticsearch (Optional - for search service)
# ==============================================
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_POST_INDEX=nova_posts
ELASTICSEARCH_USER_INDEX=nova_users

# ==============================================
# JWT Authentication
# ==============================================
# Generate keys with: openssl genpkey -algorithm RSA -out private_key.pem -pkeyopt rsa_keygen_bits:2048
# Extract public key: openssl rsa -pubout -in private_key.pem -out public_key.pem
JWT_PRIVATE_KEY_PEM="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
JWT_PUBLIC_KEY_PEM="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"

# Alternative: Load from files (if not provided as environment variables)
JWT_PRIVATE_KEY_PATH=/etc/secrets/jwt_private.pem
JWT_PUBLIC_KEY_PATH=/etc/secrets/jwt_public.pem

# JWT token expiration
JWT_ACCESS_TOKEN_EXPIRES_IN_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRES_IN_DAYS=30

# ==============================================
# AWS S3 (for media uploads)
# ==============================================
AWS_S3_BUCKET=nova-media
AWS_S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_ENDPOINT=  # Optional: for MinIO or S3-compatible storage

# ==============================================
# SMTP (for email notifications)
# ==============================================
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=SG....
SMTP_FROM_EMAIL=noreply@nova.app
SMTP_FROM_NAME=Nova

# Development: Use MailHog for testing
# SMTP_HOST=mailhog
# SMTP_PORT=1025

# ==============================================
# OAuth Providers
# ==============================================
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...
GOOGLE_REDIRECT_URI=http://localhost:8083/api/v1/auth/oauth/google/callback

# ==============================================
# APNs (iOS Push Notifications)
# ==============================================
APNS_KEY_ID=...
APNS_TEAM_ID=...
APNS_PRIVATE_KEY_PATH=/etc/secrets/apns_auth_key.p8
APNS_ENVIRONMENT=development  # development | production

# ==============================================
# FCM (Android Push Notifications)
# ==============================================
FCM_PROJECT_ID=nova-app
FCM_SERVICE_ACCOUNT_PATH=/etc/secrets/fcm_service_account.json

# ==============================================
# Service Ports (HTTP)
# ==============================================
# gRPC ports are automatically calculated as HTTP_PORT + 1000
AUTH_SERVICE_HTTP_PORT=8083
USER_SERVICE_HTTP_PORT=8080
CONTENT_SERVICE_HTTP_PORT=8081
FEED_SERVICE_HTTP_PORT=8084
MEDIA_SERVICE_HTTP_PORT=8082
MESSAGING_SERVICE_HTTP_PORT=8085
SEARCH_SERVICE_HTTP_PORT=8086
STREAMING_SERVICE_HTTP_PORT=8087
NOTIFICATION_SERVICE_HTTP_PORT=8088
CDN_SERVICE_HTTP_PORT=8089
EVENTS_SERVICE_HTTP_PORT=8090

# Service hosts (for inter-service communication)
AUTH_SERVICE_HOST=auth-service
USER_SERVICE_HOST=user-service
CONTENT_SERVICE_HOST=content-service
FEED_SERVICE_HOST=feed-service
MEDIA_SERVICE_HOST=media-service
MESSAGING_SERVICE_HOST=messaging-service
SEARCH_SERVICE_HOST=search-service
STREAMING_SERVICE_HOST=streaming-service
NOTIFICATION_SERVICE_HOST=notification-service
CDN_SERVICE_HOST=cdn-service
EVENTS_SERVICE_HOST=events-service

# ==============================================
# gRPC Configuration (Centralized)
# ==============================================
# Service URLs (default to internal Kubernetes DNS)
GRPC_AUTH_SERVICE_URL=http://auth-service:9083
GRPC_USER_SERVICE_URL=http://user-service:9080
GRPC_CONTENT_SERVICE_URL=http://content-service:9081
GRPC_FEED_SERVICE_URL=http://feed-service:9084
GRPC_MEDIA_SERVICE_URL=http://media-service:9082
GRPC_MESSAGING_SERVICE_URL=http://messaging-service:9085
GRPC_SEARCH_SERVICE_URL=http://search-service:9086
GRPC_STREAMING_SERVICE_URL=http://streaming-service:9087
GRPC_NOTIFICATION_SERVICE_URL=http://notification-service:9088
GRPC_CDN_SERVICE_URL=http://cdn-service:9089
GRPC_EVENTS_SERVICE_URL=http://events-service:9090

# Connection settings
GRPC_CONNECTION_TIMEOUT_SECS=10
GRPC_REQUEST_TIMEOUT_SECS=30
GRPC_MAX_CONCURRENT_STREAMS=1000
GRPC_KEEPALIVE_INTERVAL_SECS=30
GRPC_KEEPALIVE_TIMEOUT_SECS=10
GRPC_ENABLE_CONNECTION_POOLING=true
GRPC_CONNECTION_POOL_SIZE=10

# TLS/mTLS (optional, set GRPC_TLS_ENABLED=true to enable)
GRPC_TLS_ENABLED=false
GRPC_TLS_DOMAIN_NAME=internal.nova
GRPC_TLS_CA_CERT_PATH=/etc/certs/ca.pem
GRPC_TLS_CLIENT_CERT_PATH=/etc/certs/client.pem
GRPC_TLS_CLIENT_KEY_PATH=/etc/certs/client.key

# ==============================================
# Rate Limiting
# ==============================================
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_SECS=60

# ==============================================
# Security
# ==============================================
# CORS allowed origins (comma-separated)
CORS_ALLOWED_ORIGINS=http://localhost:3000,https://nova.app

# Session timeout
SESSION_TIMEOUT_MINUTES=60

# ==============================================
# Monitoring & Observability
# ==============================================
PROMETHEUS_PORT=9090
JAEGER_AGENT_HOST=jaeger-agent
JAEGER_AGENT_PORT=6831

# ==============================================
# Feature Flags
# ==============================================
ENABLE_FEED_SORTING=true
ENABLE_VIDEO_TRANSCODING=true
ENABLE_REAL_TIME_NOTIFICATIONS=true
ENABLE_GROUP_CALLS=true

# ==============================================
# Development/Testing
# ==============================================
# Set to 'true' to disable authentication checks (DEV ONLY)
DISABLE_AUTH=false

# Set to 'true' to enable detailed SQL query logging
DEBUG_SQL_QUERIES=false
