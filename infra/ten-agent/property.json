{
  "_ten": {
    "predefined_graphs": [
      {
        "name": "voice_assistant",
        "auto_start": true,
        "graph": {
          "nodes": [
            {
              "type": "extension",
              "name": "agora_rtc",
              "addon": "agora_rtc",
              "extension_group": "default",
              "property": {
                "app_id": "${env:AGORA_APP_ID}",
                "token": "${env:AGORA_APP_CERTIFICATE|}",
                "channel": "${env:AGORA_CHANNEL|test}",
                "stream_id": "${env:AGORA_STREAM_ID|1234}",
                "remote_stream_id": "${env:AGORA_REMOTE_STREAM_ID|123}",
                "subscribe_audio": true,
                "publish_audio": true,
                "publish_data": true,
                "subscribe_audio_sample_rate": 16000,
                "send_audio_sample_rate": 16000
              }
            },
            {
              "type": "extension",
              "name": "stt",
              "addon": "deepgram_asr_python",
              "extension_group": "stt",
              "property": {
                "api_key": "${env:DEEPGRAM_API_KEY}",
                "language": "${env:STT_LANGUAGE|zh-TW}",
                "model": "nova-2",
                "sample_rate": 16000
              }
            },
            {
              "type": "extension",
              "name": "llm",
              "addon": "openai_llm2_python",
              "extension_group": "llm",
              "property": {
                "api_key": "${env:OPENAI_API_KEY}",
                "base_url": "${env:OPENAI_BASE_URL|https://api.openai.com/v1}",
                "model": "${env:OPENAI_MODEL|gpt-4o}",
                "prompt": "${env:ALICE_PROMPT|你是 Alice，Nova 社交平台的 AI 助理。你友善、有幫助，會用繁體中文回答問題。保持回答簡潔自然，像真人對話一樣。}",
                "greeting": "${env:ALICE_GREETING|你好！我是 Alice，有什麼我可以幫助你的嗎？}",
                "max_tokens": 512,
                "temperature": 0.7,
                "max_memory_length": 10
              }
            },
            {
              "type": "extension",
              "name": "tts",
              "addon": "openai_tts_python",
              "extension_group": "tts",
              "property": {
                "api_key": "${env:OPENAI_API_KEY}",
                "base_url": "${env:OPENAI_BASE_URL|https://api.openai.com/v1}",
                "model": "tts-1",
                "voice": "${env:TTS_VOICE|nova}",
                "sample_rate": 16000
              }
            },
            {
              "type": "extension",
              "name": "main_control",
              "addon": "main_python",
              "extension_group": "control",
              "property": {
                "greeting": "${env:ALICE_GREETING|你好！我是 Alice，有什麼我可以幫助你的嗎？}"
              }
            },
            {
              "type": "extension",
              "name": "turn_detection",
              "addon": "ten_turn_detection",
              "extension_group": "default",
              "property": {
                "base_url": "${env:TTD_BASE_URL|https://api.openai.com/v1}",
                "api_key": "${env:TTD_API_KEY|${env:OPENAI_API_KEY}}"
              }
            },
            {
              "type": "extension",
              "name": "message_collector",
              "addon": "message_collector2",
              "extension_group": "transcriber",
              "property": {}
            }
          ],
          "connections": [
            {
              "extension": "main_control",
              "cmd": [
                {
                  "names": [
                    "on_user_joined",
                    "on_user_left"
                  ],
                  "source": [
                    {
                      "extension": "agora_rtc"
                    }
                  ]
                }
              ],
              "data": [
                {
                  "name": "asr_result",
                  "source": [
                    {
                      "extension": "stt"
                    }
                  ]
                }
              ]
            },
            {
              "extension_group": "default",
              "extension": "agora_rtc",
              "audio_frame": [
                {
                  "name": "pcm_frame",
                  "dest": [
                    {
                      "extension_group": "stt",
                      "extension": "stt"
                    }
                  ]
                },
                {
                  "name": "pcm_frame",
                  "source": [
                    {
                      "extension_group": "tts",
                      "extension": "tts"
                    }
                  ]
                }
              ],
              "data": [
                {
                  "name": "data",
                  "source": [
                    {
                      "extension": "message_collector"
                    }
                  ]
                }
              ]
            },
            {
              "extension_group": "stt",
              "extension": "stt",
              "data": [
                {
                  "name": "text_data",
                  "dest": [
                    {
                      "extension": "turn_detection"
                    }
                  ]
                }
              ]
            },
            {
              "extension": "turn_detection",
              "data": [
                {
                  "name": "text_data",
                  "dest": [
                    {
                      "extension": "main_control"
                    }
                  ]
                }
              ],
              "cmd": [
                {
                  "name": "flush",
                  "dest": [
                    {
                      "extension": "main_control"
                    }
                  ]
                }
              ]
            },
            {
              "extension_group": "llm",
              "extension": "llm",
              "data": [
                {
                  "name": "text_data",
                  "dest": [
                    {
                      "extension_group": "tts",
                      "extension": "tts"
                    },
                    {
                      "extension": "message_collector"
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    ],
    "log": {
      "handlers": [
        {
          "matchers": [
            {
              "level": "info"
            }
          ],
          "formatter": {
            "type": "plain",
            "colored": true
          },
          "emitter": {
            "type": "console",
            "config": {
              "stream": "stdout"
            }
          }
        }
      ]
    }
  }
}
