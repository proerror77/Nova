steps:
  # Build identity-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/identity-service:${_TAG}'
      - '-f'
      - 'backend/identity-service/Dockerfile'
      - '.'

  # Build content-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/content-service:${_TAG}'
      - '-f'
      - 'backend/content-service/Dockerfile'
      - '.'

  # Build social-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/social-service:${_TAG}'
      - '-f'
      - 'backend/social-service/Dockerfile'
      - '.'

  # Build graph-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/graph-service:${_TAG}'
      - '-f'
      - 'backend/graph-service/Dockerfile'
      - '.'

  # Build feed-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/feed-service:${_TAG}'
      - '-f'
      - 'backend/feed-service/Dockerfile'
      - '.'

  # Build ranking-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/ranking-service:${_TAG}'
      - '-f'
      - 'backend/ranking-service/Dockerfile'
      - '.'

  # Build analytics-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/analytics-service:${_TAG}'
      - '-f'
      - 'backend/analytics-service/Dockerfile'
      - '.'

  # Build notification-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/notification-service:${_TAG}'
      - '-f'
      - 'backend/notification-service/Dockerfile'
      - '.'

  # Build realtime-chat-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/realtime-chat-service:${_TAG}'
      - '-f'
      - 'backend/realtime-chat-service/Dockerfile'
      - '.'

  # Build search-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/search-service:${_TAG}'
      - '-f'
      - 'backend/search-service/Dockerfile'
      - '.'

  # Build trust-safety-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/trust-safety-service:${_TAG}'
      - '-f'
      - 'backend/trust-safety-service/Dockerfile'
      - '.'

  # Build media-service
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/media-service:${_TAG}'
      - '-f'
      - 'backend/media-service/Dockerfile'
      - '.'

  # Build graphql-gateway
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - '${_REGISTRY}/graphql-gateway:${_TAG}'
      - '-f'
      - 'backend/graphql-gateway/Dockerfile'
      - '.'

  # Push all images
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/identity-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/content-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/social-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/graph-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/feed-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/ranking-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/analytics-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/notification-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/realtime-chat-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/search-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/trust-safety-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/media-service:${_TAG}']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGISTRY}/graphql-gateway:${_TAG}']

timeout: '7200s'

substitutions:
  _REGISTRY: 'asia-northeast1-docker.pkg.dev/banded-pad-479802-k9/nova'
  _TAG: '178b5cc3'
