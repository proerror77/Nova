# åª’ä½“é€‰æ‹©æœ€ä½³å®è·µ

## âš ï¸ é‡è¦ï¼šç…§ç‰‡å’Œè§†é¢‘åº”è¯¥åˆ†å¼€å¤„ç†

### ä¸ºä»€ä¹ˆè¦åˆ†å¼€ï¼Ÿ

åœ¨ iOS App ä¸­ï¼Œ**ç…§ç‰‡ï¼ˆåŒ…æ‹¬ Live Photoï¼‰å’Œè§†é¢‘åº”è¯¥å®Œå…¨åˆ†å¼€é€‰æ‹©å’Œå¤„ç†**ã€‚è¿™æ˜¯æ ‡å‡†çš„äº§å“è®¾è®¡æ¨¡å¼ã€‚

## ğŸ“± ç”¨æˆ·ä½“éªŒè§’åº¦

### âœ… æ¨èåšæ³•ï¼šåˆ†ç¦»é€‰æ‹©

```
[æ·»åŠ ç…§ç‰‡] æŒ‰é’®  â†’  å¯é€‰æ‹©å¤šå¼ ï¼ˆ1-9å¼ ï¼‰
                  â†’  æ”¯æŒé™æ€ç…§ç‰‡ + Live Photo
                  â†’  ä¸èƒ½é€‰è§†é¢‘

[æ·»åŠ è§†é¢‘] æŒ‰é’®  â†’  åªèƒ½é€‰æ‹©1ä¸ªè§†é¢‘
                  â†’  ä¸èƒ½é€‰ç…§ç‰‡
```

**å…¸å‹åº”ç”¨ç¤ºä¾‹ï¼š**
- å¾®ä¿¡æœ‹å‹åœˆï¼šå‘ç…§ç‰‡ OR å‘è§†é¢‘ï¼Œä¸èƒ½æ··åˆ
- Instagramï¼šç…§ç‰‡è½®æ’­ OR å•ä¸ªè§†é¢‘
- Twitterï¼šå¤šå›¾æ¨¡å¼ OR è§†é¢‘æ¨¡å¼
- å°çº¢ä¹¦ï¼šå›¾æ–‡ç¬”è®° OR è§†é¢‘ç¬”è®°

### âŒ ä¸æ¨èåšæ³•ï¼šæ··åˆé€‰æ‹©

```
[é€‰æ‹©åª’ä½“] æŒ‰é’®  â†’  å¯ä»¥åŒæ—¶é€‰ç…§ç‰‡å’Œè§†é¢‘
                  â†’  UI éš¾ä»¥è®¾è®¡
                  â†’  ç”¨æˆ·å›°æƒ‘
```

**é—®é¢˜ï¼š**
1. UI å¸ƒå±€å›°éš¾ï¼ˆç…§ç‰‡ç½‘æ ¼ vs è§†é¢‘å…¨å±ï¼‰
2. æœåŠ¡ç«¯å¤„ç†å¤æ‚
3. ç”¨æˆ·æ„å›¾ä¸æ˜ç¡®

---

## ğŸ¯ æŠ€æœ¯å®ç°

### æ–¹æ¡ˆ 1: ä¸¤ä¸ªç‹¬ç«‹æŒ‰é’®ï¼ˆæ¨èï¼‰âœ¨

```swift
struct PostCreationView: View {
    // ç…§ç‰‡çŠ¶æ€
    @State private var selectedPhotoItems: [PhotosPickerItem] = []
    @State private var photoMediaItems: [PostMediaItem] = []

    // è§†é¢‘çŠ¶æ€
    @State private var selectedVideoItems: [PhotosPickerItem] = []
    @State private var videoMediaItems: [PostMediaItem] = []

    var body: some View {
        VStack {
            // ğŸ“¸ ç…§ç‰‡æŒ‰é’®
            PhotosPicker(
                selection: $selectedPhotoItems,
                maxSelectionCount: 9,
                matching: .any(of: [.images, .livePhotos])  // â† åªé€‰ç…§ç‰‡
            ) {
                Label("æ·»åŠ ç…§ç‰‡", systemImage: "photo.on.rectangle.angled")
            }
            .disabled(!videoMediaItems.isEmpty)  // å¦‚æœæœ‰è§†é¢‘ï¼Œç¦ç”¨æ­¤æŒ‰é’®

            // ğŸ¥ è§†é¢‘æŒ‰é’®
            PhotosPicker(
                selection: $selectedVideoItems,
                maxSelectionCount: 1,
                matching: .videos  // â† åªé€‰è§†é¢‘
            ) {
                Label("æ·»åŠ è§†é¢‘", systemImage: "video.fill")
            }
            .disabled(!photoMediaItems.isEmpty)  // å¦‚æœæœ‰ç…§ç‰‡ï¼Œç¦ç”¨æ­¤æŒ‰é’®
        }
    }
}
```

**ä¼˜ç‚¹ï¼š**
- âœ… ç”¨æˆ·æ„å›¾æ¸…æ™°
- âœ… UI ç®€å•ç›´è§‚
- âœ… äº’æ–¥é€»è¾‘ç®€å•ï¼ˆ`.disabled()`ï¼‰
- âœ… ç¬¦åˆä¸»æµ App è®¾è®¡

### æ–¹æ¡ˆ 2: å•æŒ‰é’® + è‡ªåŠ¨è¿‡æ»¤

```swift
struct AutoFilterView: View {
    @State private var selectedItems: [PhotosPickerItem] = []

    var body: some View {
        PhotosPicker(
            selection: $selectedItems,
            maxSelectionCount: 9,
            matching: .any(of: [.images, .livePhotos, .videos])
        ) {
            Text("é€‰æ‹©åª’ä½“")
        }
        .onChange(of: selectedItems) { items in
            // åŠ è½½åè‡ªåŠ¨è¿‡æ»¤ï¼šå¦‚æœæ··åˆäº†ç…§ç‰‡å’Œè§†é¢‘ï¼Œåªä¿ç•™ç¬¬ä¸€ç§ç±»å‹
            // âš ï¸ éœ€è¦å‘ç”¨æˆ·æ˜¾ç¤ºè­¦å‘Š
        }
    }
}
```

**ç¼ºç‚¹ï¼š**
- âš ï¸ ç”¨æˆ·å¯èƒ½å›°æƒ‘ï¼ˆä¸ºä»€ä¹ˆæˆ‘é€‰çš„è§†é¢‘è¢«ç§»é™¤äº†ï¼Ÿï¼‰
- âš ï¸ éœ€è¦é¢å¤–çš„æç¤ºå’Œè¯´æ˜
- âš ï¸ ä¸å¦‚æ–¹æ¡ˆ 1 ç›´è§‚

---

## ğŸ“Š ä¸åŒç±»å‹çš„å¤„ç†å·®å¼‚

### Live Photo vs é™æ€ç…§ç‰‡

| ç‰¹æ€§ | Live Photo | é™æ€ç…§ç‰‡ |
|------|-----------|---------|
| **æœ¬è´¨** | ç…§ç‰‡ + é…å¯¹è§†é¢‘ | å•å¼ å›¾ç‰‡ |
| **å­˜å‚¨** | 2ä¸ªæ–‡ä»¶ï¼ˆphoto + videoï¼‰ | 1ä¸ªæ–‡ä»¶ |
| **ä¸Šä¼ ** | åˆ†åˆ«ä¸Šä¼ ï¼Œè¿”å›2ä¸ªURL | ä¸Šä¼ 1ä¸ªï¼Œè¿”å›1ä¸ªURL |
| **æ˜¾ç¤º** | å¯ä»¥ç”¨ PHLivePhotoView | ç”¨ Image |
| **é€‰æ‹©å™¨** | åŒä¸€ä¸ª PhotosPicker | åŒä¸€ä¸ª PhotosPicker |
| **èƒ½å¦æ··åˆ** | âœ… å¯ä»¥ï¼ˆéƒ½æ˜¯ç…§ç‰‡ï¼‰ | âœ… å¯ä»¥ |

### ç…§ç‰‡ vs è§†é¢‘

| ç‰¹æ€§ | ç…§ç‰‡ï¼ˆLive Photo/é™æ€ï¼‰ | è§†é¢‘ |
|------|---------------------|-----|
| **æ•°é‡** | é€šå¸¸æ”¯æŒå¤šå¼ ï¼ˆ1-9ï¼‰ | é€šå¸¸åªæ”¯æŒ1ä¸ª |
| **æ—¶é•¿é™åˆ¶** | æ—  | æœ‰ï¼ˆå¦‚ 60ç§’ï¼‰ |
| **UI å¸ƒå±€** | ç½‘æ ¼/è½®æ’­ | å…¨å±/å¤§å¡ç‰‡ |
| **é¢„è§ˆæ–¹å¼** | ç¼©ç•¥å›¾ | ç¼©ç•¥å›¾ + æ’­æ”¾æŒ‰é’® + æ—¶é•¿ |
| **è½¬ç éœ€æ±‚** | å‹ç¼©å³å¯ | å¯èƒ½éœ€è¦è½¬ç  |
| **é€‰æ‹©å™¨** | `.images` + `.livePhotos` | `.videos` |
| **èƒ½å¦æ··åˆ** | âŒ ä¸æ¨è | âŒ ä¸æ¨è |

---

## ğŸ”§ å®Œæ•´å®ç°ç¤ºä¾‹

### æ¨èçš„ UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†™ç‚¹ä»€ä¹ˆ...                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“¸ æ·»åŠ ç…§ç‰‡]  [ğŸ¥ æ·»åŠ è§†é¢‘] â”‚  â† ä¸¤ä¸ªæŒ‰é’®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚  â† ç…§ç‰‡ç½‘æ ¼ï¼ˆå¦‚æœé€‰äº†ç…§ç‰‡ï¼‰
â”‚  â”‚ ğŸ“¸  â”‚ â”‚LIVE â”‚ â”‚ ğŸ“¸  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æˆ–è€…

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†™ç‚¹ä»€ä¹ˆ...                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“¸ æ·»åŠ ç…§ç‰‡]  [ğŸ¥ æ·»åŠ è§†é¢‘] â”‚  â† ä¸¤ä¸ªæŒ‰é’®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â† è§†é¢‘ï¼ˆå¦‚æœé€‰äº†è§†é¢‘ï¼‰
â”‚  â”‚      â–¶ï¸                â”‚   â”‚
â”‚  â”‚    [0:15]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ€ç®¡ç†

```swift
enum MediaSelectionState {
    case none        // è¿˜æ²¡é€‰æ‹©
    case photos      // é€‰äº†ç…§ç‰‡ï¼ˆåŒ…æ‹¬ Live Photoï¼‰
    case video       // é€‰äº†è§†é¢‘
}

struct PostViewModel {
    @Published var mediaState: MediaSelectionState = .none
    @Published var photos: [PostMediaItem] = []
    @Published var video: PostMediaItem?

    var canSelectPhotos: Bool {
        mediaState == .none || mediaState == .photos
    }

    var canSelectVideo: Bool {
        mediaState == .none
    }
}
```

---

## ğŸ“ ä»£ç æ£€æŸ¥æ¸…å•

å®ç°åª’ä½“é€‰æ‹©æ—¶ï¼Œç¡®ä¿ï¼š

- [ ] æä¾›ä¸¤ä¸ªç‹¬ç«‹çš„ PhotosPicker
- [ ] ç…§ç‰‡é€‰æ‹©å™¨ä½¿ç”¨ `.any(of: [.images, .livePhotos])`
- [ ] è§†é¢‘é€‰æ‹©å™¨ä½¿ç”¨ `.videos`
- [ ] ç…§ç‰‡å’Œè§†é¢‘æŒ‰é’®äº’æ–¥ï¼ˆç”¨ `.disabled()`ï¼‰
- [ ] ç…§ç‰‡æ”¯æŒå¤šé€‰ï¼ˆå¦‚ maxSelectionCount: 9ï¼‰
- [ ] è§†é¢‘åªæ”¯æŒå•é€‰ï¼ˆmaxSelectionCount: 1ï¼‰
- [ ] UI èƒ½æ¸…æ™°åŒºåˆ†ç…§ç‰‡ç½‘æ ¼å’Œè§†é¢‘å¡ç‰‡
- [ ] ç»™ç”¨æˆ·æç¤ºå½“å‰æ¨¡å¼ï¼ˆç…§ç‰‡ or è§†é¢‘ï¼‰
- [ ] æœåŠ¡ç«¯ API èƒ½æ­£ç¡®å¤„ç†ä¸åŒç±»å‹

---

## ğŸ¯ Nova é¡¹ç›®ä¸­çš„åº”ç”¨

### ç°æœ‰çš„ `PostMediaItem` æšä¸¾

```swift
enum PostMediaItem {
    case image(UIImage, PhotoMetadata)
    case livePhoto(LivePhotoData, PhotoMetadata)
    case video(VideoData, PhotoMetadata)
}
```

**æ­£ç¡®ç”¨æ³•ï¼š**

```swift
// âœ… ç…§ç‰‡æ•°ç»„ï¼ˆå¯ä»¥æ··åˆ image å’Œ livePhotoï¼‰
var photos: [PostMediaItem] = [
    .image(img1, metadata),
    .livePhoto(liveData, metadata),
    .image(img2, metadata)
]

// âœ… è§†é¢‘ï¼ˆå•ç‹¬ï¼‰
var video: PostMediaItem? = .video(videoData, metadata)

// âŒ é”™è¯¯ï¼šæ··åˆç…§ç‰‡å’Œè§†é¢‘
var mixed: [PostMediaItem] = [
    .image(img, metadata),
    .video(videoData, metadata)  // â† ä¸åº”è¯¥è¿™æ ·
]
```

### ä¸Šä¼ æ—¶çš„å¤„ç†

```swift
// ç…§ç‰‡ä¸Šä¼ ï¼ˆå¯ä»¥åŒ…å« Live Photoï¼‰
func uploadPhotos(_ items: [PostMediaItem]) async throws {
    for item in items {
        switch item {
        case .image(let image, _):
            // ä¸Šä¼ å•å¼ å›¾ç‰‡
            let url = try await uploadImage(image)

        case .livePhoto(let data, _):
            // ä¸Šä¼  Live Photoï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
            let urls = try await uploadLivePhoto(data)

        case .video:
            fatalError("ç…§ç‰‡æ•°ç»„ä¸åº”åŒ…å«è§†é¢‘")
        }
    }
}

// è§†é¢‘ä¸Šä¼ ï¼ˆç‹¬ç«‹ï¼‰
func uploadVideo(_ item: PostMediaItem) async throws {
    guard case .video(let data, _) = item else {
        fatalError("åº”è¯¥æ˜¯è§†é¢‘ç±»å‹")
    }

    // ä¸Šä¼ è§†é¢‘ + ç¼©ç•¥å›¾
    let urls = try await uploadVideo(data)
}
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- âœ… `SeparateMediaPickerExample.swift` - å®Œæ•´çš„åˆ†ç¦»é€‰æ‹©ç¤ºä¾‹
- âœ… `LIVE_PHOTO_GUIDE.md` - Live Photo å®ç°æŒ‡å—
- âœ… `LivePhotoManager.swift` - åª’ä½“åŠ è½½æœåŠ¡
- âš ï¸ `MediaTypeTestView.swift` - ä»…ç”¨äºæµ‹è¯•è¯†åˆ«ï¼Œä¸ç”¨äºç”Ÿäº§

---

## ğŸ‰ æ€»ç»“

**æ ¸å¿ƒåŸåˆ™ï¼šç…§ç‰‡ï¼ˆåŒ…æ‹¬ Live Photoï¼‰å’Œè§†é¢‘æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„å†…å®¹ç±»å‹ï¼Œåº”è¯¥åˆ†å¼€é€‰æ‹©å’Œå¤„ç†ã€‚**

### ä¸‰ç§åª’ä½“ç±»å‹çš„å…³ç³»

```
åª’ä½“å†…å®¹
â”œâ”€â”€ ç…§ç‰‡ âœ¨ï¼ˆå¯ä»¥æ··åˆï¼Œå¤šé€‰ï¼‰
â”‚   â”œâ”€â”€ é™æ€ç…§ç‰‡
â”‚   â””â”€â”€ Live Photo
â”‚
â””â”€â”€ è§†é¢‘ ğŸ¥ï¼ˆç‹¬ç«‹ï¼Œå•é€‰ï¼‰
```

### æ¨èåšæ³•

1. **UI å±‚**ï¼šä¸¤ä¸ªæŒ‰é’®ï¼Œäº’æ–¥é€‰æ‹©
2. **æ•°æ®å±‚**ï¼šåˆ†åˆ«ç»´æŠ¤ `photos: [PostMediaItem]` å’Œ `video: PostMediaItem?`
3. **ä¸Šä¼ å±‚**ï¼šåˆ†åˆ«å¤„ç†ç…§ç‰‡ä¸Šä¼ å’Œè§†é¢‘ä¸Šä¼ 
4. **æ˜¾ç¤ºå±‚**ï¼šç…§ç‰‡ç”¨ç½‘æ ¼ï¼Œè§†é¢‘ç”¨å¡ç‰‡

è¿™æ ·è®¾è®¡ï¼š
- âœ… ç”¨æˆ·ä½“éªŒå¥½
- âœ… ä»£ç é€»è¾‘æ¸…æ™°
- âœ… æœåŠ¡ç«¯å¤„ç†ç®€å•
- âœ… ç¬¦åˆè¡Œä¸šæ ‡å‡†
