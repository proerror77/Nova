# Nova 消息加密安全声明

**最后更新**: 2025-10-29
**版本**: 1.0
**重要性**: 🚨 所有营销、文档、iOS/Android 需遵循本文档描述

---

## ⚠️ 关键声明

Nova 应用中的消息加密采用**服务器端管理密钥的加密**（Server-Managed Encryption），**NOT 端对端加密（E2EE）**。

### ❌ 错误说法（禁用）
- "Nova 提供端对端加密（E2EE）"
- "消息完全私密，服务器无法访问"
- "Nova 采用 Signal Protocol 加密"
- "端到端加密消息"

### ✅ 正确说法（必用）
- "Nova 对传输和存储的消息进行加密"
- "消息使用 XSalsa20-Poly1305 进行加密保护"
- "服务器管理的消息加密"
- "传输层和存储层加密"

---

## 技术事实

### 当前实现（Server-Managed Encryption）

```
发送方
  ↓ (明文)
服务器端点
  ↓ (服务器加密)
PostgreSQL (密文存储)
  ↓ (服务器解密)
接收方 (明文)
```

**关键特点**：
- ✅ 消息在 REST 传输过程中加密（HTTPS + TLS）
- ✅ 消息在数据库中加密存储（XSalsa20-Poly1305）
- ✅ 消息在 Redis 缓存中加密
- ❌ 服务器持有所有密钥，可解密任何消息
- ❌ 系统管理员、执法部门可通过访问主密钥读取消息内容

**保护范围**：
1. **数据库备份泄露** → 消息内容保护 ✅
2. **Redis 快照泄露** → 消息内容保护 ✅
3. **网络拦截（无 HTTPS）** → 消息内容保护 ✅
4. **服务器被攻击** → 消息内容无保护 ❌
5. **恶意员工访问** → 消息内容无保护 ❌

---

## 真正的 E2EE 是什么样的

### 理想的 E2EE（Signal / WhatsApp）

```
发送方 (明文)
  ↓ (发送方加密)
传输(密文)
  ↓
服务器 (无法读取)
  ↓ (转发密文)
接收方 (解密)
```

**关键特点**：
- 客户端生成和管理密钥对
- 服务器只转发密文，无法访问
- 即使服务器遭到攻击也无法读取历史消息
- 需要 Signal Protocol 或类似的双棘轮算法

---

## 法律与合规声明

### 隐私政策更新

**必须在隐私政策中说明**：

> "Nova 对消息内容进行服务器端加密，使用 XSalsa20-Poly1305 算法。消息在数据库和缓存中以密文形式存储。但是，Nova 公司及其员工可以使用主密钥访问消息内容。如果您需要完全隐私的通讯，请寻求端对端加密（E2EE）的应用。"

### 不向用户做出的承诺

❌ **禁止说**：
- "完全隐私通讯"
- "Nova 无法读取您的消息"
- "国家执法部门无法读取您的消息"
- "消息仅有您和对方可见"

### 可以向用户做出的承诺

✅ **可以说**：
- "消息在传输和存储过程中进行加密"
- "您的消息受到加密保护，防止数据库泄露"
- "消息不会以明文形式存储在我们的服务器上"
- "Nova 采用行业标准加密算法（NaCl）"

---

## 迁移计划（未来工作）

### Phase 1: 当前状态（Now）
- 服务器端加密
- 密钥由 Nova 管理
- 消息数据库泄露时受保护

### Phase 2: 认证密钥交换（3-6 个月）
- 添加设备密钥对管理
- 用户可导出/管理密钥
- Keychain 安全存储

### Phase 3: 真正的 E2EE（6-12 个月）
- Signal Protocol 集成
- 客户端生成和管理密钥
- 服务器无法读取消息
- 需要支持群组和媒体文件

---

## 立即行动清单

### 1. 文档更新（Today）
- [ ] 更新 iOS 营销文档，移除 "E2EE" 说法
- [ ] 更新 Android 营销文档，移除 "E2EE" 说法
- [ ] 在隐私政策中添加本声明内容
- [ ] 更新产品功能页面

### 2. 代码注释更新（This Week）
- [ ] 在 messaging-service 中添加 "Server-Managed" 注释
- [ ] 在 iOS 中更新加密功能注释
- [ ] 在 Android 中更新加密功能注释

### 3. 团队沟通（Today）
- [ ] 通知营销团队：禁用 E2EE 说法
- [ ] 通知法律团队：审查隐私政策
- [ ] 通知客服团队：准备用户解释文案

### 4. 用户沟通（Next Week）
- [ ] 如果曾宣传过 E2EE，发送澄清通知
- [ ] 在应用内添加"关于加密"信息
- [ ] 定期更新用户关于隐私保护

---

## Q&A

**Q: 为什么不立即实现 E2EE？**
A: E2EE 需要重大架构改动：
1. 客户端密钥对生成和存储
2. Signal Protocol 或 Olm 算法集成（3-4 个月）
3. 群组和多设备支持（额外 2-3 个月）
4. 推送通知需要重新设计（额外 1 个月）
5. 总计 6-12 个月工程时间

**Q: 当前加密有什么缺点？**
A:
1. 服务器持有密钥，可被访问
2. 执法部门可通过法庭令要求访问密钥
3. 恶意员工可读取消息
4. 合规要求（GDPR）可能要求我们删除消息，但密钥被泄露时无法保护

**Q: 哪些数据确实受保护？**
A:
1. 数据库备份（加密存储）
2. Redis 缓存（加密存储）
3. 网络传输（HTTPS/TLS）
4. 硬盘空间泄露（加密内容）

**Q: 我们应该何时向用户承诺 E2EE？**
A: 仅当实现了客户端加密且服务器无法读取密文时。

**Q: 如何与用户交流这个限制？**
A:
> "Nova 目前使用服务器管理的加密来保护您的消息。消息在传输和存储中被加密，但 Nova 可以通过持有的主密钥访问内容。我们正在规划真正的端对端加密，预计在 2026 年上半年推出。"

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0 | 2025-10-29 | 初始版本：明确说明服务器端加密，禁用 E2EE 说法 |

---

## 相关文档

- `backend/messaging-service/STRICT_E2E_ENCRYPTION.md` - 技术实现细节
- `backend/EXECUTIVE_SUMMARY.md` - 架构概览
- `ios/iOS_EXECUTIVE_SUMMARY.md` - iOS 功能清单（已更新）

---

## 审核签名

**需要审核的角色**：
- [ ] 法律团队
- [ ] 产品管理
- [ ] 工程主管
- [ ] 安全团队

**发布日期**: 待审核批准

---

**重要**: 本文档是官方加密安全的唯一来源。所有营销、文档、代码注释必须引用本文档。任何关于 E2EE 的说法必须先获得法律和工程的批准。

May the Force be with you.
