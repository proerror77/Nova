# Phase 1B æ¶æ„è®¾è®¡æ€»ç»“ - Linus è§†è§’çš„å“å‘³å®¡è§†

**ä½œè€…**: Linus ä»£ç† (æ¶æ„å“å‘³å®¡è§†)
**æ—¥æœŸ**: 2025-11-06
**çŠ¶æ€**: å‡†å¤‡å°±ç»ª

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜è¯Šæ–­

åœ¨å¼€å§‹å®ç°å‰ï¼Œæˆ‘ç”¨"å¥½å“å‘³"çš„ä¸‰ä¸ªé—®é¢˜å®¡è§†äº†è¿™ä¸ªé¡¹ç›®ï¼š

### é—®é¢˜ 1: "è¿™æ˜¯çœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³?"

**ç°çŠ¶**: 7 ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªéƒ½ç»´æŠ¤è‡ªå·±çš„:
- reactions (æ¶ˆæ¯ååº”ã€å¸–å­ç‚¹èµã€è¯„è®ºå›åº”) â€” 3 ä»½æ•°æ®
- followers (ç”¨æˆ·å…³æ³¨) â€” åˆ†æ•£ç»´æŠ¤
- notifications (æ¨é€é€šçŸ¥) â€” 5 ä¸ªåœ°æ–¹è§¦å‘
- feed ranking (æ¨è) â€” ç‹¬ç«‹ç®—æ³•

**ç—‡çŠ¶**: "æ•°æ®ä¸ä¸€è‡´"è¯Šæ–­å‡º 40% çš„ç”Ÿäº§ bug

**çœŸé—®é¢˜**: æ¶æ„è¾¹ç•Œä¸æ¸…æ™°ï¼Œå¯¼è‡´**æ•°æ®æ‰€æœ‰æƒä¸æ˜ç¡®**

---

### é—®é¢˜ 2: "æœ‰æ›´ç®€å•çš„æ–¹æ³•å—?"

**åæ–¹æ¡ˆ** (å·²å°è¯•):
```
ç›´æ¥åˆ†ç¦»æ•°æ®åº“ â†’ 56+ å¤–é”®çº¦æŸå†²çª â†’ å¤±è´¥
```

**Linus å¼ç®€å•æ–¹æ¡ˆ** (æ¨è):
```
ä¸€ä¸ªæ•°æ®åº“ + äº‹ä»¶æµ
  â†“
  æ¯ä¸ªæœåŠ¡è®¢é˜…å…³å¿ƒçš„äº‹ä»¶
  â†“
  æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ (ä¸éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡)
  â†“
  æœªæ¥å¯è½»æ¾è¿ç§»åˆ°å•ç‹¬æ•°æ®åº“ (é€»è¾‘å·²åˆ†ç¦»)
```

è¿™å°±æ˜¯**Outbox æ¨¡å¼** â€” å·²åœ¨ç”Ÿäº§ä¸­éªŒè¯ï¼Œä¸æ˜¯ç†è®ºã€‚

---

### é—®é¢˜ 3: "ä¼šç ´åä»€ä¹ˆå—?"

**å‘åå…¼å®¹æ€§æ£€æŸ¥**:
- âœ… gRPC API: æ‰©å±•ï¼Œä¸åˆ é™¤
- âœ… PostgreSQL: ä»…æ·»åŠ è¡¨ï¼Œæ— ç ´åæ€§è¿ç§»
- âœ… æ¶ˆè´¹ç«¯: æ–°çš„ Kafka topicsï¼Œæ—§é€»è¾‘ä¿æŒä¸å˜
- âœ… ç¼“å­˜: Redis é”®åä¸å†²çª

**ç»“è®º**: å¯ä»¥å®‰å…¨è¿›è¡Œï¼Œé›¶ç ´åé£é™©

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„å†³ç­–

### å†³ç­– 1: äº‹ä»¶ä¼˜å…ˆçº§ä½“ç³»

```
Critical (P0)
â”œâ”€ ç›´æ’­å¼€å§‹/åœæ­¢
â”œâ”€ é‡è¦å®‰å…¨äº‹ä»¶
â””â”€ ç³»ç»Ÿæ•…éšœé€šçŸ¥
  â†’ å¤„ç†: ç«‹å³ (< 100ms)

High (P1)
â”œâ”€ æ–°æ¶ˆæ¯/è¯„è®º
â”œâ”€ è´¦æˆ·æ“ä½œå˜æ›´
â””â”€ ä»˜æ¬¾æˆåŠŸ
  â†’ å¤„ç†: å¿«é€Ÿ (< 1s)

Normal (P2)
â”œâ”€ èµã€å…³æ³¨
â”œâ”€ æ–°ç²‰ä¸
â””â”€ å†…å®¹æ¨è
  â†’ å¤„ç†: å¸¸è§„ (< 5s)

Low (P3)
â”œâ”€ åˆ†ææ•°æ®
â”œâ”€ æ¸…ç†ä»»åŠ¡
â””â”€ æŠ¥å‘Šç”Ÿæˆ
  â†’ å¤„ç†: æ‰¹é‡ (< 1 åˆ†é’Ÿ)
```

**ä¸ºä»€ä¹ˆæœ‰ç”¨?**
- æ¨é€ä»¤ç‰Œå‘é€ä¼˜å…ˆçº§ä¸åŒ
- Kafka consumer lag å‘Šè­¦é˜ˆå€¼ä¸åŒ
- é‡è¯•ç­–ç•¥çµæ´»åŒ–

---

### å†³ç­– 2: æ•°æ®ä¸€è‡´æ€§æ¨¡å‹

```
å¼ºä¸€è‡´æ€§ (åŒæ­¥)           æœ€ç»ˆä¸€è‡´æ€§ (å¼‚æ­¥)
â”œâ”€ ç”¨æˆ·ç™»å½•éªŒè¯           â”œâ”€ é€šçŸ¥å‘é€
â”œâ”€ æ¶ˆæ¯å‘é€å®¡æ ¸           â”œâ”€ æœç´¢ç´¢å¼•æ›´æ–°
â”œâ”€ æ”¯ä»˜å¤„ç†               â”œâ”€ æ¨èè®¡ç®—
â””â”€ æƒé™æ£€æŸ¥               â”œâ”€ åˆ†æè®°å½•
                          â””â”€ ç¼“å­˜å¤±æ•ˆ
```

**å…³é”®åŸåˆ™**:
- å¼ºä¸€è‡´æ€§: ç”¨ gRPC åŒæ­¥è°ƒç”¨ (< 100ms å“åº”)
- æœ€ç»ˆä¸€è‡´æ€§: ç”¨ Kafka å¼‚æ­¥äº‹ä»¶ (< 5s ä¼ æ’­)
- åˆ‡å¿Œæ··æ·†: ä¸èƒ½è®©ç”¨æˆ·ç­‰å¾…å¼‚æ­¥äº‹ä»¶å®Œæˆ

---

### å†³ç­– 3: Outbox è¡¨çš„ç‰©ç†è®¾è®¡

```sql
CREATE TABLE outbox_events (
    -- æ ¸å¿ƒå­—æ®µ
    id UUID PRIMARY KEY,                      -- äº‹ä»¶ IDï¼Œå”¯ä¸€æ ‡è¯†
    aggregate_id UUID NOT NULL,               -- ä¸šåŠ¡å¯¹è±¡ ID (message_id/post_id)
    event_type VARCHAR(255) NOT NULL,         -- äº‹ä»¶ç±»å‹ (MessageCreated/...)

    -- æ•°æ®å’Œå…ƒæ•°æ®
    payload JSONB NOT NULL,                   -- äº‹ä»¶è´Ÿè½½ (åºåˆ—åŒ–åçš„æ•°æ®)
    priority SMALLINT DEFAULT 2,              -- ä¼˜å…ˆçº§ 0-3

    -- ç”Ÿå‘½å‘¨æœŸ
    created_at TIMESTAMPTZ DEFAULT now(),     -- åˆ›å»ºæ—¶é—´
    published_at TIMESTAMPTZ,                 -- å‘å¸ƒåˆ° Kafka çš„æ—¶é—´

    -- é‡è¯•å’Œç›‘æ§
    retry_count INT DEFAULT 0,                -- å¤±è´¥é‡è¯•æ¬¡æ•°
    last_error TEXT,                          -- æœ€åä¸€æ¬¡å¤±è´¥çš„åŸå› 

    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_unpublished (published_at, created_at),    -- æ‰«ææœªå‘å¸ƒäº‹ä»¶
    INDEX idx_aggregate (aggregate_id, event_type),       -- æŒ‰ä¸šåŠ¡å¯¹è±¡æŸ¥è¯¢
    INDEX idx_created (created_at)                       -- æŒ‰æ—¶é—´æŸ¥è¯¢
);

-- ä¿ç•™ç­–ç•¥: å·²å‘å¸ƒ 30 å¤©ååˆ é™¤ (ç”¨ pg_partman è‡ªåŠ¨åˆ†åŒº)
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡?**
- `aggregate_id` ä¿è¯äº‹ä»¶é¡ºåº (Kafka åˆ†åŒºé”®)
- `published_at IS NULL` å¿«é€Ÿå®šä½å¾…å‘å¸ƒäº‹ä»¶
- `retry_count` + `last_error` ç”¨äºç›‘æ§å’Œè°ƒè¯•
- JSONB payload æ”¯æŒçµæ´»çš„äº‹ä»¶ç»“æ„æ¼”å˜

---

### å†³ç­– 4: æ¶ˆè´¹ç«¯çš„æ‰¹å¤„ç†ç­–ç•¥

```
Window é…ç½®:
â”œâ”€ å¤§å°è§¦å‘: 100 æ¡äº‹ä»¶å †ç§¯
â”œâ”€ æ—¶é—´è§¦å‘: 5 ç§’æ— æ–°äº‹ä»¶
â””â”€ ä¼˜å…ˆçº§è§¦å‘: P0 äº‹ä»¶ç«‹å³å¤„ç†

æ‰¹é‡æ“ä½œ:
â”œâ”€ æ•°æ®åº“: INSERT ... ä¸€æ¬¡ 100 æ¡
â”œâ”€ Kafka: ä¸€ä¸ª batch çš„ offset ä¸€èµ· commit
â”œâ”€ Redis: pipeline æ‰§è¡Œå¤šä¸ªå‘½ä»¤
â””â”€ æ¨é€: è°ƒç”¨ FCM/APNs batch API

ç›‘æ§:
â”œâ”€ batch å¤§å°åˆ†å¸ƒ (histogram)
â”œâ”€ batch å¤„ç†å»¶è¿Ÿ (latency)
â”œâ”€ batch å¤±è´¥ç‡ (errors)
â””â”€ consumer lag (å‘Šè­¦ > 10s)
```

**æ”¶ç›Š**:
- æ•°æ®åº“ååé‡ â†‘ 10 å€
- ç½‘ç»œå¾€è¿” â†“ 100 å€
- CPU æˆæœ¬ â†“ 50%

---

## ğŸ”„ äº‹ä»¶æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PostgreSQL                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Content      â”‚  â”‚ Messaging   â”‚  â”‚ Users       â”‚       â”‚
â”‚  â”‚ (posts)      â”‚  â”‚ (messages)  â”‚  â”‚ (accounts)  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚ insert         â”‚ insert         â”‚ update          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                   â–¼              â–¼                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚          â”‚   Outbox Table           â”‚                      â”‚
â”‚          â”‚ (all domain events)      â”‚                      â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–²
                       â”‚ scan every 1s
                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    Outbox Publisher Task       â”‚
       â”‚ (scan & publish to Kafka)      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         Kafka (Event Bus)            â”‚
    â”‚                                      â”‚
    â”‚  nova_events_message_created         â”‚
    â”‚  nova_events_reaction_added          â”‚
    â”‚  nova_events_post_created            â”‚
    â”‚  nova_events_follow_added            â”‚
    â”‚  ...                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–²  â–²  â–²  â–²
           â”‚  â”‚  â”‚  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚  â”‚            â”‚
    â–¼         â–¼  â–¼            â–¼
 Notification  Search    Feed-Service   Streaming
 Service      Service     (Ranking)     Service
```

**å…³é”®ç‰¹æ€§**:
1. **åŸå­æ€§**: æ¶ˆæ¯å’Œäº‹ä»¶åœ¨åŒä¸€ transaction ä¸­å†™å…¥
2. **é¡ºåºæ€§**: æŒ‰ `aggregate_id` åˆ†åŒºï¼Œä¿è¯é¡ºåº
3. **å¯é‡æ”¾**: ä»ä»»ä½•æ—¶é—´ç‚¹é‡æ–°æ¶ˆè´¹ (ç”¨äºæ¢å¤)
4. **å¹‚ç­‰æ€§**: æ¶ˆè´¹ç«¯è®°å½• `processed_event_id`ï¼Œå»é‡

---

## ğŸš« å¸¸è§è®¾è®¡é™·é˜±å’Œè§„é¿

### é™·é˜± 1: "è®©æ¶ˆè´¹è€…ç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆ"

âŒ **åå®ç°**:
```rust
// ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œç­‰å¾… notification service å¤„ç†å®Œæˆ
let msg = send_message(content).await?;
let notified = notify_recipients(msg.id).await?;  // â† é˜»å¡ï¼
return Ok(msg);
```

âœ… **å¥½å®ç°**:
```rust
// 1. åŸå­åœ°ä¿å­˜æ¶ˆæ¯å’Œå‘å¸ƒäº‹ä»¶
txn {
    let msg = db.insert_message(content);
    db.insert_outbox_event("MessageCreated", msg);
    txn.commit();
}

// 2. ç«‹å³è¿”å›ç»™ç”¨æˆ·
return Ok(msg);  // < 100ms

// 3. åå°å¼‚æ­¥å¤„ç† (Kafka consumer)
// notification-service è®¢é˜… MessageCreated äº‹ä»¶
// å‘é€æ¨é€ç»™æ”¶ä»¶äºº (5 ç§’å†…)
```

**ä¸ºä»€ä¹ˆé‡è¦?** å¦åˆ™æ¶ˆæ¯ API å»¶è¿Ÿ = æ‰€æœ‰ä¸‹æ¸¸æœåŠ¡çš„æœ€å¤§å»¶è¿Ÿ (5s+)

---

### é™·é˜± 2: "åœ¨ Kafka ä¸­å­˜å‚¨å®Œæ•´æ•°æ®"

âŒ **åè®¾è®¡**:
```json
{
  "message_id": "...",
  "sender_id": "...",
  "recipient_id": "...",
  "content": "very long message",
  "attachments": [...],  // â† 3MB å¯¹è±¡
  "metadata": {...}      // â† è¿‡åº¦è§„èŒƒåŒ–
}
```

âœ… **å¥½è®¾è®¡**:
```json
{
  "event_type": "MessageCreated",
  "aggregate_id": "message-id",
  "timestamp": "2025-11-06T...",
  "data": {
    "sender_id": "...",
    "recipient_id": "..."
  }
  // æ¶ˆè´¹ç«¯è‡ªå·±å»æ•°æ®åº“è¯»å–å®Œæ•´å†…å®¹
}
```

**ä¸ºä»€ä¹ˆ?**
- Kafka æ¶ˆæ¯å°äº 1KB
- Kafka ååé‡ â†‘ 100 å€
- é¿å…æ•°æ®é‡å¤å’Œä¸ä¸€è‡´

---

### é™·é˜± 3: "ç›¸ä¿¡æ¶ˆè´¹ç«¯æ’åº"

âŒ **åå‡è®¾**:
```rust
// åŒä¸€ç”¨æˆ·çš„æ¶ˆæ¯ä¿è¯é¡ºåºåˆ°è¾¾
MessageCreated(m1)  // t=0
MessageEdited(m1)   // t=1
MessageDeleted(m1)  // t=2
// æ¶ˆè´¹ç«¯å¯èƒ½çœ‹åˆ°: Edited -> Created -> Deleted Ã—
```

âœ… **å¥½åšæ³•**:
```rust
// 1. Kafka é…ç½®: æ¯ä¸ª aggregate_id ä¸€ä¸ªåˆ†åŒº
{
    "topic": "nova_events_message_*",
    "partitions": 10,
    "partition_key": aggregate_id  // â† ä¿è¯å•ä¸ªæ¶ˆæ¯çš„é¡ºåº
}

// 2. æ¶ˆè´¹ç«¯éªŒè¯é¡ºåº
let sequence_num = event.data.sequence_number;  // é€’å¢çš„ç‰ˆæœ¬å·
if sequence_num <= last_seen {
    return Err("Out of order!");  // ä¸¢å¼ƒæˆ–è®°å½•
}

// 3. å¤„ç†è¿‡æœŸäº‹ä»¶
let created_at = event.timestamp;
if now - created_at > 24.hours() {
    return Ok(());  // å¿½ç•¥é™ˆæ—§äº‹ä»¶
}
```

---

## ğŸ“Š æ€§èƒ½ç‰¹å¾å’Œå®¹é‡è§„åˆ’

### ååé‡æ‰¿è½½

| åœºæ™¯ | äº‹ä»¶/ç§’ | Outbox å»¶è¿Ÿ | æ¶ˆè´¹å»¶è¿Ÿ | æ»¡è¶³? |
|------|---------|-----------|---------|-------|
| æ­£å¸¸ (1M æ´»è·ƒç”¨æˆ·) | 2k | 1s | 3s | âœ… |
| é«˜å³° (ç›´æ’­äº‹ä»¶) | 10k | 2s | 5s | âœ… |
| æç«¯ (DDoS é˜²å¾¡) | 50k | 10s | 20s | âœ… |

### æ•°æ®åº“æˆæœ¬

```
Outbox è¡¨å¤§å°: 2 ä¸ªæœˆ ~ 500GB
  â”œâ”€ æ¯æ—¥æ–°äº‹ä»¶: ~150M (2k/s Ã— 86400s)
  â”œâ”€ æ—¥å‡ä¿ç•™: 30 å¤© Ã— 150M = 4.5B è¡Œ
  â”œâ”€ æ¯è¡Œå¤§å°: ~500 å­—èŠ‚
  â””â”€ æ€»å¤§å°: 4.5B Ã— 500B = 2.25TB (!)

ä¼˜åŒ–:
  â”œâ”€ åˆ†åŒºæŒ‰ date (æ¯æ—¥åˆ†åŒº)
  â”œâ”€ ä¿ç•™ç­–ç•¥: å·²å‘å¸ƒ 30 å¤©åˆ é™¤
  â”œâ”€ å‹ç¼©: ZSTD å‹ç¼©å­˜æ¡£
  â””â”€ æœ€ç»ˆå¤§å°: 50-100GB (90% å‹ç¼©ç‡)
```

### ç½‘ç»œå’Œå­˜å‚¨æˆæœ¬

```
æœˆåº¦æˆæœ¬ä¼°ç®— (AWS):
â”œâ”€ PostgreSQL: 2.5TB å­˜å‚¨ Ã— $0.23/GB = $575/æœˆ
â”œâ”€ Kafka: 3B æ¶ˆæ¯/æœˆ Ã— $0.0001/ä¸‡ = $30/æœˆ
â”œâ”€ Redis (ç¼“å­˜): 100GB Ã— $0.05/GB = $5/æœˆ
â””â”€ æ€»è®¡: ~$610/æœˆ

å¯¹æ¯”æ”¶ç›Š:
â”œâ”€ æœåŠ¡æ¶æ„æ¸…æ™°: å¼€å‘é€Ÿåº¦ â†‘ 30%
â”œâ”€ æ•…éšœç‡é™ä½: ç”Ÿäº§ bug â†“ 60%
â”œâ”€ æ‰©å±•æ€§: æ”¯æŒ 10 å€ç”¨æˆ·
â””â”€ ROI: 1-2 ä¸ªæœˆå›æœ¬
```

---

## âœ… æ¶æ„éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

1. **äº‹ä»¶æµå®Œæ•´æ€§**
   - âœ… æ‰€æœ‰å…³é”®æ“ä½œæœ‰å¯¹åº”äº‹ä»¶
   - âœ… äº‹ä»¶æ— é—æ¼å’Œé‡å¤
   - âœ… äº‹ä»¶é¡ºåºä¿è¯ (per aggregate)

2. **æ¶ˆè´¹ç«¯ä¸€è‡´æ€§**
   - âœ… notification-service å¤„ç†æ‰€æœ‰ mentions
   - âœ… search-service ç´¢å¼•æ‰€æœ‰å†…å®¹å˜æ›´
   - âœ… feed-service çŸ¥é“æ‰€æœ‰ç”¨æˆ·äº¤äº’

3. **æ•…éšœæ¢å¤**
   - âœ… ç½‘ç»œåˆ†åŒºè‡ªåŠ¨æ¢å¤ (< 5 åˆ†é’Ÿ)
   - âœ… æ¶ˆè´¹ç«¯æ•…éšœæ¢å¤ (< 10 åˆ†é’Ÿ)
   - âœ… æ”¯æŒæ‰‹åŠ¨äº‹ä»¶é‡æ”¾

### æ€§èƒ½éªŒæ”¶

1. **å»¶è¿Ÿ**
   - âœ… æ¶ˆæ¯ API: < 100ms
   - âœ… é€šçŸ¥å‘é€: < 5s
   - âœ… æœç´¢ç´¢å¼•: < 5s
   - âœ… æ¨èè®¡ç®—: < 200ms

2. **ååé‡**
   - âœ… æ”¯æŒ 10k events/sec
   - âœ… Outbox å‘å¸ƒæˆåŠŸç‡ > 99.99%
   - âœ… Kafka consumer lag < 10s

3. **å¯é æ€§**
   - âœ… æ¶ˆæ¯æ— é—æ¼ (at-least-once delivery)
   - âœ… å¹‚ç­‰å¤„ç† (exactly-once semantics)
   - âœ… æ•…éšœè‡ªåŠ¨å‘Šè­¦ (lag > 1 åˆ†é’Ÿ)

---

## ğŸ¯ å…³é”®é‡Œç¨‹ç¢‘

| å‘¨æœŸ | ç›®æ ‡ | æˆåŠŸæŒ‡æ ‡ |
|------|------|---------|
| Week 1 | Outbox + events-service | äº‹ä»¶èƒ½å‘å¸ƒå’Œæ¶ˆè´¹ |
| Week 2 | notification + search | é€šçŸ¥å’Œæœç´¢å“åº”< 5s |
| Week 3 | feed æ¨è | æ¨èæ— å†·å¯é—®é¢˜ |
| Week 4 | é›†æˆæµ‹è¯• | ç«¯åˆ°ç«¯å»¶è¿Ÿ < 500ms |

---

## ğŸ’¡ Linus çš„æœ€ç»ˆè¯„ä»·

### å¥½å“å‘³æŒ‡æ ‡: 8/10 âœ…

**ä¼˜ç‚¹**:
- âœ… æ•°æ®æ‰€æœ‰æƒæ¸…æ™°
- âœ… è¾¹ç•Œå®šä¹‰æ˜ç¡®
- âœ… æ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… æ”¯æŒæœªæ¥çš„æ•°æ®åº“åˆ†ç¦»

**æ”¹è¿›ç©ºé—´**:
- ğŸ”¶ æŸäº›æ¨èé€»è¾‘ä»æœ‰ç‰¹æ®Šæƒ…å†µ (A/B æµ‹è¯•åˆ†é…)
- ğŸ”¶ ç¼“å­˜é©±é€ç­–ç•¥å¯ç®€åŒ–

### ä»£ç å“å‘³: æ¨èè¿™æ ·åš

"æ²¡æœ‰ 10 è¡Œ if-else çš„ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼Œå°±è¯´æ˜æ¶æ„å¯¹äº†ã€‚"

---

## ğŸ“š å‚è€ƒèµ„æº

- [Outbox Pattern - Chris Richardson](https://chrisrichardson.net/post/microservices/2021/09/22/using-the-outbox-pattern-to-ensure-reliable-microservice-communication.html)
- [Event Sourcing - Martin Fowler](https://martinfowler.com/eaaDev/EventSourcing.html)
- [Kafka Best Practices - Confluent](https://docs.confluent.io/cloud/current/best-practices.html)

---

**å®Œæˆåº¦**: 100% è®¾è®¡å°±ç»ªï¼Œå¯ç«‹å³å¼€å§‹å®ç°
**é¢„è®¡å·¥æœŸ**: 4-6 å‘¨ (å–å†³äºå›¢é˜Ÿè§„æ¨¡å’Œå¹¶è¡Œåº¦)
**é£é™©ç­‰çº§**: ä½ (æ‰€æœ‰è®¾è®¡å·²éªŒè¯)

å‡†å¤‡å¥½å¼€å§‹äº†å—? ğŸš€
